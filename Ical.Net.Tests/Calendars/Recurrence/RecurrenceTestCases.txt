# Monday and Thursday, 3 times.
RRULE:FREQ=WEEKLY;BYDAY=MO,TH;COUNT=3
DTSTART:20241024
INSTANCES:20241024,20241028,20241031

# Illegal rule part with multiple '='
RRULE:FREQ=WEEKLY;BYDAY=MO=;COUNT=3
EXCEPTION:System.ArgumentOutOfRangeException

# The first date belongs to 2009, so after 6 years it will be 2015, which has a week 53.
RRULE:FREQ=YEARLY;BYWEEKNO=53;BYDAY=TU,SA;INTERVAL=6;UNTIL=20170101T000000Z
DTSTART:20100102T000000
INSTANCES:20100102T000000,20151229T000000,20160102T000000

# The first date belongs to 2009, so after 5 years it will be 2014, which has NO week 53.
RRULE:FREQ=YEARLY;BYWEEKNO=53;BYDAY=TU,SA;INTERVAL=5;UNTIL=20170101T000000Z
DTSTART:20100102T000000
INSTANCES:20100102T000000

# The first date belongs to 2009, so after 7 years it will be 2014, which has NO week 53.
RRULE:FREQ=YEARLY;BYWEEKNO=53;BYDAY=TU,SA;INTERVAL=7;UNTIL=20170101T000000Z
DTSTART:20100102T000000
INSTANCES:20100102T000000

# DTSTART is in 2024 but the week belongs to 2025, so after 3 years it will be 2028.
RRULE:FREQ=YEARLY;BYWEEKNO=1;BYDAY=MO,TU;INTERVAL=3;UNTIL=20320101
DTSTART:20241231
INSTANCES:20241231,20280103,20280104,20301230,20301231


# 30.12 in WEEK 1 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=12;BYMONTHDAY=1,30;BYWEEKNO=1;UNTIL=20320101
DTSTART:20241230
INSTANCES:20241230,20251230,20301230,20311230

# 30.12 in WEEK 1 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=-2;BYWEEKNO=1;UNTIL=20320101
DTSTART:20241230
INSTANCES:20241230,20251230,20301230,20311230

# 30.12 in WEEK 52 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=12;BYMONTHDAY=1,30;BYWEEKNO=52;UNTIL=20340101
DTSTART:20271230
INSTANCES:20271230,20281230,20291230,20331230

# 30.12 in WEEK 52 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=-2;BYWEEKNO=52;UNTIL=20340101
DTSTART:20271230
INSTANCES:20271230,20281230,20291230,20331230

# 30.12 in WEEK 53 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=12;BYMONTHDAY=1,30;BYWEEKNO=53;UNTIL=20380101
DTSTART:20261230
INSTANCES:20261230,20321230,20371230

# 30.12 in WEEK 53 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=-2;BYWEEKNO=53;UNTIL=20380101
DTSTART:20261230
INSTANCES:20261230,20321230,20371230

# 2.1 in WEEK 1 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=1;BYMONTHDAY=2,31;BYWEEKNO=1;UNTIL=20290102
DTSTART:20250102
INSTANCES:20250102,20260102,20290102

# 2.1 in WEEK 1 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=2;BYWEEKNO=1;UNTIL=20290102
DTSTART:20250102
INSTANCES:20250102,20260102,20290102

# 2.1 in WEEK 52 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=1;BYMONTHDAY=2,31;BYWEEKNO=52;UNTIL=20390102
DTSTART:20280102
INSTANCES:20280102,20390102

# 2.1 in WEEK 52 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=2;BYWEEKNO=52;UNTIL=20390102
DTSTART:20280102
INSTANCES:20280102,20390102

# 2.1 in WEEK 53 with expansion on BYMONTH, BYMONTHDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYMONTH=1;BYMONTHDAY=2,31;BYWEEKNO=53;UNTIL=20380102
DTSTART:20270102
INSTANCES:20270102,20330102,20380102

# 2.1 in WEEK 53 with expansion on BYYEARDAY, BYWEEKNO
RRULE:FREQ=YEARLY;BYYEARDAY=2;BYWEEKNO=53;UNTIL=20380102
DTSTART:20270102
INSTANCES:20270102,20330102,20380102

# BYMONTHDAY with limit behaviour; reproduces #728 as reported by pinkfloydx33
RRULE:FREQ=DAILY;BYMONTHDAY=20,-2;UNTIL=20250401
DTSTART:20250220
INSTANCES:20250220,20250227,20250320,20250330

# BYYEARDAY with limit behaviour; BYHOUR limit behaviour
RRULE:FREQ=HOURLY;BYHOUR=0;BYYEARDAY=360,-2;UNTIL=20260101T000000
DTSTART:20251220T000000
INSTANCES:20251226T000000,20251230T000000

# BYYEARDAY with 1st day of the year and UNTIL
RRULE:FREQ=YEARLY;BYYEARDAY=1,10;UNTIL=20260105
DTSTART:20250110
INSTANCES:20250110,20260101

# BYHOUR, BYMINUTE, BYSECOND limit behaviour
# note that the max number of increments is 1000, so we can only observer a limited time span
RRULE:FREQ=SECONDLY;BYHOUR=1,2;BYMINUTE=3,4,59;BYSECOND=5,6;UNTIL=20250216T020500
DTSTART:20250216T015905
INSTANCES:20250216T015905,20250216T015906,20250216T020305,20250216T020306,20250216T020405,20250216T020406

# BYWEEKNO 1 - UNTIL and the last recurrence are in 2024 while the week is 1 of 2025.
RRULE:FREQ=YEARLY;BYWEEKNO=1;BYDAY=MO;UNTIL=20241230
DTSTART:20240101
INSTANCES:20240101,20241230

# Evaluation without bounds must result in a specific exception
RRULE:FREQ=YEARLY
DTSTART:20240101
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Evaluation until year 9999 must succeed
RRULE:FREQ=YEARLY;COUNT=2
DTSTART:99980101
INSTANCES:99980101,99990101

# Evaluation until year 10000 should fail
RRULE:FREQ=YEARLY;COUNT=3
DTSTART:99980101
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# The end stil falls in the year 9999, so it should succeed
RRULE:FREQ=YEARLY;COUNT=1
DTSTART:99990101
DURATION:P364D
INSTANCES:99990101

# The end exceeds year 9999, so it should fail
RRULE:FREQ=YEARLY;COUNT=1
DTSTART:99990101
DURATION:P365D
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Due to the size of the interval we'll cause a DateTime overflow.
RRULE:FREQ=YEARLY;INTERVAL=10000000;COUNT=2
DTSTART:20240101
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Due to the size of the interval, this time with freq=WEEKLY we'll cause a DateTime overflow.
RRULE:FREQ=WEEKLY;INTERVAL=2000000000;COUNT=2
DTSTART:20240101
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# The 3rd recurrence is on 10000-01-02, which exceeds the limit.
RRULE:FREQ=YEARLY;BYWEEKNO=-1;BYDAY=SU;COUNT=3
DTSTART:99971228
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Yearly recurrence starting on Feb 28 of a leap year, 5 occurrences
DTSTART:20240228
RRULE:FREQ=YEARLY;COUNT=5
INSTANCES:20240228,20250228,20260228,20270228,20280228

# Yearly recurrence starting on Feb 29 of a leap year, 4 occurrences
DTSTART:20240229
RRULE:FREQ=YEARLY;COUNT=4
INSTANCES:20240229,20280229,20320229,20360229

# First and last day of the year, 3 occurrences with first/last day of year expansion, issue #889
DTSTART:20250101
RRULE:FREQ=YEARLY;BYYEARDAY=-1,1;BYMONTHDAY=-1,1;COUNT=3
INSTANCES:20250101,20251231,20260101

# Second and second last day of June, all occurrences in June 2025, issue #889
DTSTART:20250601
RRULE:FREQ=YEARLY;BYMONTH=6;BYMONTHDAY=2,-2;UNTIL=20250630
INSTANCES:20250602,20250629

############################## START ERRATA 1913 TESTS ##############################
# RFC errata 1913 (https://www.rfc-editor.org/errata_search.php?rfc=1913&amp;eid=1913):
# 'The numeric value in a BYDAY rule part with the FREQ rule part set to YEARLY corresponds  
# to an offset within the month when the BYMONTH rule part is present, and corresponds to an 
# offset within the year when the BYWEEKNO or BYMONTH rule parts are NOT present.'
# 
# These 12 tests verify the behavior with the interpretation that
# * when only BYMONTH is present, the numeric BYDAY offset applies within the month,
# * when BYWEEKNO is present, the numeric BYDAY offset applies within the week.
#   Note: RFC says that BYWEEKNO + numeric BYDAY is invalid. We're taking the lenient approach here.
#
# Disclaimer: Other iCalendar libraries may interpret this differently.

# Yearly BYMONTH numeric BYDAY (2MO) - 2nd Monday in each BYMONTH
RRULE:FREQ=YEARLY;BYMONTH=6,9;BYDAY=2MO;COUNT=4
DTSTART:20260608T090000
INSTANCES:20260608T090000,20260914T090000,20270614T090000,20270913T090000

# Yearly without BYMONTH numeric BYDAY (20MO) - 20th Monday of the YEAR
RRULE:FREQ=YEARLY;BYDAY=20MO;COUNT=3
DTSTART:20260518T090000
INSTANCES:20260518T090000,20270517T090000,20280515T090000

# Yearly BYMONTH negative BYDAY (-1SU) - last Sunday of each BYMONTH
RRULE:FREQ=YEARLY;BYMONTH=6,9;BYDAY=-1SU;COUNT=2
DTSTART:20260628T090000
INSTANCES:20260628T090000,20260927T090000

# Yearly BYMONTH=3 BYDAY=1MO - valid: 1st Monday of March each year
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=1MO;UNTIL=20270101T000000Z
DTSTART:20240304T090000
START-AT:20240101
INSTANCES:20240304T090000,20250303T090000,20260302T090000

# Yearly BYMONTH=3 BYDAY=6MO - invalid: 6th Monday in March doesn't exist
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=6MO
DTSTART:20240101T090000
START-AT:20240101
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Yearly BYWEEKNO=10 BYDAY=1MO - valid: Monday of ISO week 10 each year
RRULE:FREQ=YEARLY;BYWEEKNO=10;BYDAY=1MO;COUNT=3
DTSTART:20240304T090000
INSTANCES:20240304T090000,20250303T090000,20260302T090000

# Yearly BYWEEKNO=10 BYDAY=2MO - invalid: 2nd Monday in a week doesn't exist -> out of range
RRULE:FREQ=YEARLY;BYWEEKNO=10;BYDAY=2MO
DTSTART:20240101T090000
EXCEPTION:Ical.Net.Evaluation.EvaluationOutOfRangeException
EXCEPTION-STEP:Enumeration

# Monthly BYMONTHDAY=13 with BYDAY=MO
RRULE:FREQ=MONTHLY;BYMONTHDAY=13;BYDAY=MO;UNTIL=20271231T235959Z
DTSTART:20250913T090000
START-AT:20251013
INSTANCES:20251013T090000,20260413T090000,20260713T090000,20270913T090000,20271213T090000

# Yearly BYMONTHDAY BYDAY
RRULE:FREQ=YEARLY;BYMONTHDAY=8,9;BYDAY=WE,TH;UNTIL=20280101
DTSTART:20250409
INSTANCES:20250409,20260408,20260409,20270408

# Yearly BYMONTHDAY=1,8 with BYDAY offsets (expand matrix - note2)
RRULE:FREQ=YEARLY;BYMONTHDAY=1,8;BYDAY=22MO,23TU,25MO,36TU;UNTIL=20350101T000000
DTSTART:20260601
INSTANCES:20260601,20270608,20320608

# Monthly BYMONTHDAY=1,8; BYDAY=1MO,2TU - limiting behavior: Monthly by month day with day offsets
RRULE:FREQ=MONTHLY;BYMONTHDAY=1,8;BYDAY=1MO,2TU;UNTIL=20270101
DTSTART:20260601
INSTANCES:20260601,20260908,20261208

# Yearly BYMONTH=6-12; BYMONTHDAY=1,8; BYDAY=1MO,2TU - Yearly by month and by month day, with day offsets
RRULE:FREQ=YEARLY;BYMONTH=6,7,8,9,10,11,12;BYMONTHDAY=1,8;BYDAY=1MO,2TU;UNTIL=20270101
DTSTART:20260601
INSTANCES:20260601,20260908,20261208

############################## END ERRATA 1913 TESTS ##############################

# BY rules are ordered when expanded
RRULE:FREQ=YEARLY;BYMONTH=5,4;BYWEEKNO=16,15;BYYEARDAY=99,98;BYMONTHDAY=9,8;BYDAY=WE,TU;BYHOUR=2,1;BYMINUTE=4,3;BYSECOND=6,5;COUNT=8
DTSTART:20250201T000000
INSTANCES:20250408T010305,20250408T010306,20250408T010405,20250408T010406,20250408T020305,20250408T020306,20250408T020405,20250408T020406

# Limiting BYYEARDAY and BYDAY
RRULE:FREQ=YEARLY;BYYEARDAY=152,173,251,272,321,342;BYDAY=22MO,26MO,36TU,37TU,49TU;COUNT=3
DTSTART:20260601
INSTANCES:20260601,20260908,20261208

# Positive BYSETPOS with some sets being empty
RRULE:FREQ=MONTHLY;BYMONTHDAY=1,2,3;BYDAY=MO,TU;BYSETPOS=1;COUNT=3
DTSTART:20260202
INSTANCES:20260202,20260302,20260601

# Negative BYSETPOS with some sets being empty
RRULE:FREQ=MONTHLY;BYMONTHDAY=1,2,3;BYDAY=MO,TU;BYSETPOS=-1;COUNT=3
DTSTART:20260203
INSTANCES:20260203,20260303,20260602

# Yearly BYDAY with positive BYSETPOS
RRULE:FREQ=YEARLY;BYDAY=WE;BYSETPOS=1,3,6;COUNT=4
DTSTART:20250101
INSTANCES:20250101,20250115,20250205,20260107

# Yearly BYDAY with positive and negative BYSETPOS
RRULE:FREQ=YEARLY;BYDAY=WE;BYSETPOS=1,3,6,-3,-1;COUNT=6
DTSTART:20250101
INSTANCES:20250101,20250115,20250205,20251217,20251231,20260107

# Yearly BYDAY with unordered positive and negative offsets
RRULE:FREQ=YEARLY;BYDAY=1WE,-1WE,-1SA,6WE,3WE,-3WE;COUNT=7
DTSTART:20250101
INSTANCES:20250101,20250115,20250205,20251217,20251227,20251231,20260107

# Monthly BYDAY with unordered positive and negative offsets
RRULE:FREQ=MONTHLY;BYDAY=1WE,-1WE,-1SA,6WE,3WE,1SA,-3WE;COUNT=11
DTSTART:20250101
INSTANCES:20250101,20250104,20250115,20250125,20250129,20250201,20250205,20250212,20250219,20250222,20250226

# Monthly BYDAY with and without offsets
RRULE:FREQ=MONTHLY;BYDAY=MO,2TU;COUNT=4
DTSTART:20250106
INSTANCES:20250106,20250113,20250114,20250120

# Yearly BYMONTH BYWEEKNO BYDAY excludes days before the month
RRULE:FREQ=YEARLY;BYMONTH=2;BYWEEKNO=5;BYDAY=FR,SA;COUNT=3
DTSTART:20250201
INSTANCES:20250201,20270205,20270206

# Yearly BYMONTH BYWEEKNO BYDAY excludes days after the month
RRULE:FREQ=YEARLY;BYMONTH=1;BYWEEKNO=5;BYDAY=FR,SA;COUNT=2
DTSTART:20250131
INSTANCES:20250131,20260130

# Negative BYDAY limiting due to BYYEARDAY
RRULE:FREQ=YEARLY;BYYEARDAY=-1,-2;BYDAY=-1WE;COUNT=4
DTSTART:20251220
INSTANCES:20251231,20261230,20311231,20361231

# Negative BYDAY limiting due to BYMONTH
RRULE:FREQ=YEARLY;BYMONTH=11,12;BYMONTHDAY=31,30;BYDAY=-1WE;COUNT=4
DTSTART:20251126
INSTANCES:20251231,20261230,20311231,20331130

# COUNT is correct with duplicate BYWEEKNO values
RRULE:FREQ=YEARLY;BYWEEKNO=1,-52;COUNT=2
DTSTART:20250101
INSTANCES:20250101,20251231

# COUNT is correct with duplicate BYYEARDAY values
RRULE:FREQ=YEARLY;BYYEARDAY=1,-365;COUNT=2
DTSTART:20250101
INSTANCES:20250101,20260101

# COUNT is correct with duplicate BYMONTHDAY values
RRULE:FREQ=YEARLY;BYMONTHDAY=1,-31;COUNT=2
DTSTART:20250101
INSTANCES:20250101,20260101

# COUNT is correct with duplicate BYDAY values
RRULE:FREQ=MONTHLY;BYDAY=3WE,-3WE;COUNT=2
DTSTART:20250115
INSTANCES:20250115,20250212

# COUNT is correct with duplicate BYSETPOS values
RRULE:FREQ=YEARLY;BYSETPOS=1,-1;COUNT=2
DTSTART:20250101
INSTANCES:20250101,20260101

# Minutely BYMINUTE
RRULE:FREQ=MINUTELY;BYMINUTE=4,23;COUNT=6
DTSTART:20250101T000000
INSTANCES:20250101T000400,20250101T002300,20250101T010400,20250101T012300,20250101T020400,20250101T022300

# Minutely BYMINUTE with an interval larger than 1 hour
RRULE:FREQ=MINUTELY;BYMINUTE=5,25;INTERVAL=61;COUNT=6
DTSTART:20250101T000000
INSTANCES:20250101T050500,20250102T012500,20250103T180500,20250104T142500,20250106T070500,20250107T032500

# Secondly get occurrences after from DTSTART
RRULE:FREQ=SECONDLY;UNTIL=20250402T000000
DTSTART:20250401T235858
START-AT:20250401T235958
INSTANCES:20250401T235958,20250401T235959,20250402T000000

# Get occurrences far from DTSTART
#RRULE:FREQ=SECONDLY;UNTIL=20250402T000000
#DTSTART:20000101T000000
#START-AT:20250401T235958
#INSTANCES:20250401T235958,20250401T235959,20250402T000000

# BYDAY offset with an invalid frequency should throw exception
RRULE:FREQ=DAILY;BYDAY=1MO
DTSTART:20240101
EXCEPTION:Ical.Net.Evaluation.EvaluationException
EXCEPTION-STEP:Enumeration

# BYYEARDAY skips when BYMONTH does not match
RRULE:FREQ=YEARLY;BYMONTH=3;BYYEARDAY=60;COUNT=4
DTSTART:20260301
INSTANCES:20260301,20270301,20290301,20300301